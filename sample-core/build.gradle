buildscript {
  repositories {
    maven { url 'https://jitpack.io' }
  }

  dependencies {
    classpath "com.github.hurricup:gradle-grammar-kit-plugin:2017.1.1"
  }
}

apply plugin: 'kotlin'
apply plugin: 'org.jetbrains.grammarkit'
grammarKit {
  grammarKitRelease = '1.5.2'
}

import org.jetbrains.grammarkit.tasks.GenerateParser

sourceSets {
  main.java.srcDir "gen"
}

dependencies {
  compileOnly dep.intellijCore

  implementation dep.kotlinStdLib
  implementation project(':core')
}

task generateSampleParser(type: GenerateParser) {
  source "src/main/grammars/sample-sqlite.bnf"
  targetRoot = 'gen/'
  pathToParser '/com/alecstrong/sqlite/psi/sample/core/parser/SampleParser.java'
  pathToPsiRoot '/com/alecstrong/sqlite/psi/sample/core/psi'
  purgeOldFiles = true
}

compileKotlin.dependsOn generateSampleParser
